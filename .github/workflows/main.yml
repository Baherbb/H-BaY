name: H-BaY Frontend CI

on:
  push:
    branches: [ "main", "develop" ]
  pull_request:
    branches: [ "main", "develop" ]

jobs:
  frontend-ci:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout Code
        uses: actions/checkout@v4

      - name: Use Node.js 18.x
        uses: actions/setup-node@v4
        with:
          node-version: '18.x'
          cache: 'npm'
          cache-dependency-path: ./frontend/package-lock.json

      - name: Install Frontend Dependencies
        working-directory: ./frontend
        run: npm ci

      - name: Create ESLint Config
        working-directory: ./frontend
        run: |
          cat > .eslintrc.json << EOF
          {
            "extends": [
              "react-app",
              "react-app/jest"
            ],
            "rules": {
              "@typescript-eslint/no-unused-vars": ["warn", {
                "argsIgnorePattern": "^_",
                "varsIgnorePattern": "^_",
                "ignoreRestSiblings": true
              }],
              "jsx-a11y/iframe-has-title": "warn",
              "jsx-a11y/anchor-is-valid": "warn",
              "jsx-a11y/heading-has-content": "warn",
              "react-hooks/exhaustive-deps": "warn"
            }
          }
          EOF

      - name: Run Frontend Linter
        working-directory: ./frontend
        run: npm run lint -- --max-warnings 0

      - name: Run Frontend Tests
        working-directory: ./frontend
        env:
          REACT_APP_API_URL: http://localhost:3000
        run: npm test

      - name: Build Frontend
        working-directory: ./frontend
        env:
          REACT_APP_API_URL: http://localhost:3000
        run: npm run build
